<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Iniciar sesión con Google</title>
  <script type="module">
    // Importar Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBZvcvGrPIBwhvOzp6EZzTq7IHzGuRErHs",
      authDomain: "blog2025-8088a.firebaseapp.com",
      projectId: "blog2025-8088a",
      storageBucket: "blog2025-8088a.firebasestorage.app",
      messagingSenderId: "749428454575",
      appId: "1:749428454575:web:048dbc52892c7a09a6905a"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // 🔥 Login con Google
    window.loginWithGoogle = async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const token = await result.user.getIdToken();
        console.log("🔑 Token de Firebase:", token);

        const response = await fetch("/login/firebase/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ idToken: token })
        });

        const data = await response.json();
        console.log("✅ Login backend:", data);

        if (response.ok) {
          alert(`Bienvenido ${data.email}`);
          window.location.href = "/"; // redirige donde quieras
        } else {
          alert("❌ Error: " + data.error);
        }

      } catch (error) {
        console.error("🔥 Error en login:", error);
        alert("Ocurrió un error al autenticar con Google");
      }
    };
  </script>
</head>
<body style="font-family: sans-serif; text-align: center; padding-top: 80px;">
  <h5>Iniciar sesión con Google 🔐</h5>
  <button onclick="loginWithGoogle()">Acceder con Google</button>
</body>
</html>
