{% extends "base.html" %}

{% load  static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/myblog.css' %}">
{% endblock css %}

{% block content %}
{% include "includes/header.html" %}

<div class="container text-light " style="min-height: 600px">
    <div class="row mb-4 mt-4">
            <div class="col-2 d-none d-sm-block d-md-none d-lg-block">
            </div>
        <div class="col-lg-8 bg-primary">
            <form class=" mt-2 mb-2"   method="POST" enctype="multipart/form-data">{% csrf_token %}
                <div class="col-12 mt-4 mb-4 ">
                    <p class="h3 text-center">Agregar Nuevo Post</p>
                </div>
                <div class="col-12 form-row  mb-4 justify-content-center">
                        <div class="col-2">
                            <p>In Home:</p>
                            {{form.in_home}}
                        </div>
                        <div class="col-2">
                            <p>Publico:</p>
                            {{form.public}}
                        </div>
                        <div class="col-2">
                            <p>Portada:</p>
                            {{form.portada}}
                        </div>
                        <div class="col-5">
                            <select name="tag" class="form-control form-control-sm w-85" required="" id="id_tag" multiple="">
                                <option value="1" selected="selected">Programacion en Python</option>

                            </select>
                        </div>
                    </div>

                    <div class="form-row justify-content-center">
                        <div class="col-6">
                            <p>Usuario</p>
                            <input type="text" value="{{ user.email }}" class="form-control form-control-sm" readonly>
                        </div>
                        <div class="col-6">
                            <p>Categor√≠a</p>
                            {{ form.category }}
                        </div>
                            <div class="col-6">
                                <p>titulo</p>
                                {{form.title}}
                            </div>
                            <div class="col-6">
                                <p>resumen</p>
                                {{form.resume}}
                            </div>
                        <div class="col-12">
                            <h5>Contenido</h5>
                            <button type="button" id="quick-code-btn" class="btn btn-sm btn-warning mb-2" title="Selecciona texto y haz clic aqu√≠ (o usa Ctrl+K)">
                                <i class="fa fa-code"></i> üìù Convertir a C√≥digo
                            </button>
                            {{form.media}}
                            {{form.content}}
                        </div>
                        <div class="col 12">
                            <p>Imagen</p>
                            {{form.image}}
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-12  mt-4 mb-4 text-center">
                            <button type="submit" class=" text-white btn btn-success btn-block">Guardar</button>
                        </div>
                    </div>
            </form>
        </div>
        <div class="col-2 d-none d-sm-block d-md-none d-lg-block">

        </div>
    </div>
</div>

<script>
// Script para convertir texto seleccionado en code snippet con Ctrl+K
document.addEventListener('DOMContentLoaded', function() {
    // Esperar a que CKEditor est√© completamente cargado
    if (typeof CKEDITOR !== 'undefined') {
        CKEDITOR.on('instanceReady', function(evt) {
            var editor = evt.editor;

            // Verificar si el editor tiene el plugin codesnippet
            if (editor.plugins.codesnippet) {

                // Funci√≥n para convertir texto a code snippet
                function convertToCodeSnippet() {
                    var selection = editor.getSelection();
                    var selectedText = selection.getSelectedText();

                    if (selectedText && selectedText.trim() !== '') {
                        // Escapar caracteres especiales HTML
                        var escapedText = selectedText
                            .replace(/&/g, '&amp;')
                            .replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/"/g, '&quot;')
                            .replace(/'/g, '&#39;');

                        // Crear el code snippet
                        var codeSnippet = '<pre><code class="language-python">' + escapedText + '</code></pre>';

                        // Eliminar la selecci√≥n actual e insertar el code snippet
                        editor.insertHtml('');
                        editor.insertHtml(codeSnippet);

                        console.log('‚úÖ Code snippet insertado');
                    } else {
                        // Si no hay texto seleccionado, abrir el di√°logo normal
                        editor.execCommand('codesnippet');
                    }
                }

                // Agregar comando personalizado
                editor.addCommand('quickCodeSnippet', {
                    exec: convertToCodeSnippet
                });

                // Asignar atajo de teclado: Ctrl+K
                editor.setKeystroke(CKEDITOR.CTRL + 75, 'quickCodeSnippet');

                // Conectar el bot√≥n HTML con la funci√≥n
                document.getElementById('quick-code-btn').addEventListener('click', function(e) {
                    e.preventDefault();
                    convertToCodeSnippet();
                });

                console.log('‚úÖ Atajo Ctrl+K y bot√≥n HTML configurado');
            }
        });
    }
});
</script>

{% endblock content %}